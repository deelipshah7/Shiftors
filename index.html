<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shift Manager</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: auto;
        }
        .hidden { display: none; }
        .week-container {
            margin-bottom: 10px;
            border: 1px solid black;
            padding: 10px;
        }
        .week-header {
            background: #ccc;
            padding: 10px;
            cursor: pointer;
        }
        .shift-details {
            margin-top: 10px;
            padding: 5px;
        }
        .delete-btn, .edit-btn {
            margin-left: 10px;
            cursor: pointer;
            color: red;
        }
    </style>
</head>
<body>

    <!-- Login / Signup Section -->
    <div id="authSection">
        <h2>Login / Signup</h2>
        <input type="text" id="username" placeholder="Enter username">
        <input type="password" id="password" placeholder="Enter password">
        <button onclick="signup()">Sign Up</button>
        <button onclick="login()">Login</button>
        <p id="authMessage"></p>
    </div>

    <!-- Main Content (After Login) -->
    <div id="mainContent" class="hidden">
        <h2>Shift Management</h2>
        <button onclick="showShiftForm()">Add Shift</button>
        <div id="shiftForm" class="hidden">
            <select id="day">
                <option value="Monday">Monday</option>
                <option value="Tuesday">Tuesday</option>
                <option value="Wednesday">Wednesday</option>
                <option value="Thursday">Thursday</option>
                <option value="Friday">Friday</option>
                <option value="Saturday">Saturday</option>
                <option value="Sunday">Sunday</option>
            </select>
            <input type="time" id="startTime">
            <input type="time" id="endTime">
            <button onclick="addShift()">Add</button>
        </div>
        <h3>Your Shifts:</h3>
        <div id="shiftContainer"></div>
    </div>

    <script>
        let users = {};
        let loggedInUser = null;
        let shifts = {}; // Stores shifts by week

        function signup() {
            let username = document.getElementById("username").value;
            let password = document.getElementById("password").value;

            if (users[username]) {
                document.getElementById("authMessage").innerText = "Username already registered. Try another.";
            } else {
                users[username] = password;
                document.getElementById("authMessage").innerText = "Sign-up successful! Please log in.";
            }
        }

        function login() {
            let username = document.getElementById("username").value;
            let password = document.getElementById("password").value;

            if (users[username] === password) {
                loggedInUser = username;
                document.getElementById("authSection").classList.add("hidden");
                document.getElementById("mainContent").classList.remove("hidden");
            } else {
                document.getElementById("authMessage").innerText = "Invalid credentials.";
            }
        }

        function showShiftForm() {
            document.getElementById("shiftForm").classList.toggle("hidden");
        }

        function addShift() {
            let day = document.getElementById("day").value;
            let startTime = document.getElementById("startTime").value;
            let endTime = document.getElementById("endTime").value;

            if (!startTime || !endTime) return alert("Please enter valid shift times.");

            let weekEnding = getWeekEnding();
            if (!shifts[weekEnding]) shifts[weekEnding] = [];

            let shift = { day, startTime, endTime };
            shifts[weekEnding].push(shift);
            renderShifts();
        }

        function getWeekEnding() {
            let today = new Date();
            let daysUntilSunday = 7 - today.getDay();
            let weekEndDate = new Date(today);
            weekEndDate.setDate(today.getDate() + daysUntilSunday);
            return `Week ending ${weekEndDate.toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: '2-digit' })}`;
        }

        function renderShifts() {
            let container = document.getElementById("shiftContainer");
            container.innerHTML = "";

            let sortedWeeks = Object.keys(shifts).sort((a, b) => new Date(b.split(' ')[2]) - new Date(a.split(' ')[2]));

            sortedWeeks.forEach(week => {
                let weekDiv = document.createElement("div");
                weekDiv.classList.add("week-container");

                let header = document.createElement("div");
                header.classList.add("week-header");
                header.innerText = week;
                header.onclick = () => {
                    let details = weekDiv.querySelector(".shift-details");
                    details.classList.toggle("hidden");
                };

                let detailsDiv = document.createElement("div");
                detailsDiv.classList.add("shift-details", "hidden");

                shifts[week].forEach((shift, index) => {
                    let shiftDiv = document.createElement("div");
                    shiftDiv.innerHTML = `${shift.day} ${shift.startTime} - ${shift.endTime} 
                        <span class="edit-btn" onclick="editShift('${week}', ${index})">✏️</span>
                        <span class="delete-btn" onclick="deleteShift('${week}', ${index})">❌</span>`;
                    detailsDiv.appendChild(shiftDiv);
                });

                let calcBtn = document.createElement("button");
                calcBtn.innerText = "Calculate Earnings";
                calcBtn.onclick = () => calculateEarnings(week, detailsDiv);
                detailsDiv.appendChild(calcBtn);

                weekDiv.appendChild(header);
                weekDiv.appendChild(detailsDiv);
                container.appendChild(weekDiv);
            });
        }

        function editShift(week, index) {
            let newTime = prompt("Enter new start and end time (HH:MM-HH:MM):");
            if (!newTime) return;
            let [start, end] = newTime.split("-");
            shifts[week][index].startTime = start;
            shifts[week][index].endTime = end;
            renderShifts();
        }

        function deleteShift(week, index) {
            shifts[week].splice(index, 1);
            if (shifts[week].length === 0) delete shifts[week];
            renderShifts();
        }

        function calculateEarnings(week, container) {
            let totalEarnings = 0;
            shifts[week].forEach(shift => {
                let rate = (shift.day === "Sunday") ? 44.89 : 32.07;
                let hours = (new Date(`1970-01-01T${shift.endTime}`) - new Date(`1970-01-01T${shift.startTime}`)) / 3600000;
                totalEarnings += rate * hours;
            });

            let tax = totalEarnings > 18200 ? (totalEarnings - 18200) * 0.16 : 0;
            container.innerHTML += `<p>Total Earnings: $${totalEarnings.toFixed(2)} | Tax: $${tax.toFixed(2)} | Receivable: $${(totalEarnings - tax).toFixed(2)}</p>`;
        }
    </script>

</body>
</html>
