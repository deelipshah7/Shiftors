<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Keep all previous styles -->
  <style>
    /* Previous styles remain the same */
    .week-item {
      margin-bottom: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
    }
    .week-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
    }
    .shift-actions {
      margin-top: 5px;
    }
    .edit-btn {
      background-color: #ffc107;
      margin-right: 5px;
    }
    .delete-btn {
      background-color: #dc3545;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <!-- Previous HTML structure remains the same until weeklySummary div -->
  <div id="weeklySummary"></div>

  <script>
    // Previous code remains the same until displayWeeklySummary function

    function displayWeeklySummary(shifts) {
      weeklySummary.innerHTML = '<h2>Weekly Summary</h2>';
      const weeks = groupShiftsByWeek(shifts);
      const sortedWeeks = sortWeeks(weeks);

      sortedWeeks.forEach(week => {
        const weekElement = createWeekElement(week);
        weeklySummary.appendChild(weekElement);
      });
    }

    function groupShiftsByWeek(shifts) {
      const weeks = {};
      shifts.forEach(shift => {
        const date = new Date(shift.date);
        const weekStart = new Date(date);
        weekStart.setDate(date.getDate() - date.getDay());
        const weekKey = weekStart.toISOString().split('T')[0];
        
        if (!weeks[weekKey]) {
          weeks[weekKey] = {
            startDate: weekStart,
            shifts: [],
            gross: 0,
            tax: 0,
            net: 0
          };
        }
        
        const [hours, minutes] = shift.hoursWorked.split(' hours and ');
        const totalHours = parseFloat(hours) + parseFloat(minutes) / 60;
        const payRate = getPayRate(shift.date, shift.startTime);
        const earnings = totalHours * payRate;
        
        weeks[weekKey].shifts.push({...shift, earnings});
        weeks[weekKey].gross += earnings;
      });

      // Calculate tax and net for each week
      Object.values(weeks).forEach(week => {
        week.tax = calculateTax(week.gross);
        week.net = week.gross - week.tax;
      });

      return Object.values(weeks);
    }

    function sortWeeks(weeks) {
      return weeks.sort((a, b) => b.startDate - a.startDate);
    }

    function createWeekElement(week) {
      const weekElement = document.createElement('div');
      weekElement.className = 'week-item';
      
      const weekStart = week.startDate;
      const weekName = `Week ${String(weekStart.getDate()).padStart(2, '0')}/${String(weekStart.getMonth() + 1).padStart(2, '0')}/${String(weekStart.getFullYear()).slice(-2)}`;

      weekElement.innerHTML = `
        <div class="week-header">
          <strong>${weekName}</strong>
          <span>$${week.net.toFixed(2)}</span>
        </div>
        <div class="week-details hidden"></div>
      `;

      const detailsDiv = weekElement.querySelector('.week-details');
      const headerDiv = weekElement.querySelector('.week-header');

      headerDiv.addEventListener('click', () => {
        document.querySelectorAll('.week-details').forEach(d => d.classList.add('hidden'));
        detailsDiv.classList.toggle('hidden');
      });

      // Add week summary
      const summary = document.createElement('div');
      summary.className = 'week-summary';
      summary.innerHTML = `
        Gross Pay: $${week.gross.toFixed(2)}<br>
        Tax: $${week.tax.toFixed(2)}<br>
        Net Pay: $${week.net.toFixed(2)}
      `;
      detailsDiv.appendChild(summary);

      // Add shifts list
      const shiftsList = document.createElement('ul');
      week.shifts.forEach((shift, index) => {
        const li = document.createElement('li');
        li.innerHTML = `
          <strong>${shift.date}</strong><br>
          ${shift.startTime} - ${shift.endTime}<br>
          Earnings: $${shift.earnings.toFixed(2)}
          <div class="shift-actions">
            <button class="edit-btn" data-index="${index}">Edit</button>
            <button class="delete-btn" data-index="${index}">Delete</button>
          </div>
        `;
        shiftsList.appendChild(li);
      });
      detailsDiv.appendChild(shiftsList);

      // Add event listeners for edit/delete buttons
      detailsDiv.querySelectorAll('.edit-btn').forEach(btn => {
        btn.addEventListener('click', (e) => editShift(week, e.target.dataset.index));
      });
      
      detailsDiv.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', (e) => deleteShift(week, e.target.dataset.index));
      });

      return weekElement;
    }

    function editShift(week, index) {
      const shift = week.shifts[index];
      const [date, startTime, ampm] = shift.date.split('T')[0], shift.startTime.split(' ');
      const [hour, minute] = startTime.split(':');
      
      // Populate form fields
      document.getElementById('date').value = shift.date;
      document.getElementById('startHour').value = hour.padStart(2, '0');
      document.getElementById('startMinute').value = minute;
      document.getElementById('startAmPm').value = ampm;
      // Similar for end time...
      document.getElementById('breakTime').value = shift.breakTime;

      // Update form to edit mode
      shiftForm.dataset.editing = JSON.stringify({week: week.startDate.toISOString(), index});
      shiftForm.querySelector('button').textContent = 'Update Shift';
    }

    function deleteShift(week, index) {
      const userShifts = JSON.parse(localStorage.getItem(`shifts_${currentUser}`)) || [];
      const updatedShifts = userShifts.filter(s => {
        const shiftWeek = new Date(s.date);
        shiftWeek.setDate(shiftWeek.getDate() - shiftWeek.getDay());
        return shiftWeek.getTime() !== week.startDate.getTime() || 
               !week.shifts[index].date.includes(s.date);
      });
      
      localStorage.setItem(`shifts_${currentUser}`, JSON.stringify(updatedShifts));
      displayShifts();
    }

    // Update shift form submission handler
    shiftForm.addEventListener('submit', (e) => {
      e.preventDefault();

      // Existing code to collect shift data...

      const userShifts = JSON.parse(localStorage.getItem(`shifts_${currentUser}`)) || [];
      
      if (shiftForm.dataset.editing) {
        // Handle edit
        const {week, index} = JSON.parse(shiftForm.dataset.editing);
        delete shiftForm.dataset.editing;
        // Find and update the shift
        // (Implementation details depend on your data structure)
      } else {
        // Add new shift
        userShifts.push(newShift);
      }

      localStorage.setItem(`shifts_${currentUser}`, JSON.stringify(userShifts));
      displayShifts();
      shiftForm.reset();
      shiftForm.querySelector('button').textContent = 'Save Shift';
    });

    // Rest of the code remains the same
  </script>
</body>
</html>
