<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Work Shift Tracker</title>
  <style>
    /* Previous CSS styles remain unchanged */
  </style>
</head>
<body>
  <!-- Login/Signup Containers (same as previous) -->

  <!-- Main Application Container -->
  <div class="container hidden" id="shiftContainer">
    <!-- Shift Entry Form (same as previous) -->
    <!-- Weekly Summaries Section -->
    <div id="weekList"></div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Previous DOM references and state variables

      // Complete User Management
      document.getElementById('switchToSignup').addEventListener('click', () => {
        loginContainer.classList.add('hidden');
        signupContainer.classList.remove('hidden');
      });

      document.getElementById('switchToLogin').addEventListener('click', () => {
        signupContainer.classList.add('hidden');
        loginContainer.classList.remove('hidden');
      });

      signupForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const users = JSON.parse(localStorage.getItem('users')) || [];
        const newUsername = document.getElementById('newUsername').value;
        
        if (users.some(u => u.username === newUsername)) {
          alert('Username already exists!');
          return;
        }

        users.push({
          username: newUsername,
          password: document.getElementById('newPassword').value
        });
        localStorage.setItem('users', JSON.stringify(users));
        alert('Account created successfully! Please login.');
        signupForm.reset();
        signupContainer.classList.add('hidden');
        loginContainer.classList.remove('hidden');
      });

      loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const users = JSON.parse(localStorage.getItem('users')) || [];
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        
        const user = users.find(u => u.username === username && u.password === password);
        if (user) {
          currentUser = username;
          loginContainer.classList.add('hidden');
          shiftContainer.classList.remove('hidden');
          displayShifts();
        } else {
          alert('Invalid username or password!');
        }
      });

      // Complete Shift Form Handler
      shiftForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const shifts = JSON.parse(localStorage.getItem(`shifts_${currentUser}`)) || [];
        
        // Convert to 24-hour format
        const to24h = (hour, minute, period) => {
          let hr = parseInt(hour);
          if (period === 'PM' && hr !== 12) hr += 12;
          if (period === 'AM' && hr === 12) hr = 0;
          return `${hr.toString().padStart(2, '0')}:${minute}`;
        };

        const newShift = {
          date: document.getElementById('date').value,
          startTime: to24h(
            document.getElementById('startHour').value,
            document.getElementById('startMinute').value,
            document.getElementById('startAmPm').value
          ),
          endTime: to24h(
            document.getElementById('endHour').value,
            document.getElementById('endMinute').value,
            document.getElementById('endAmPm').value
          ),
          breakTime: parseInt(document.getElementById('breakTime').value)
        };

        if (editingIndex !== null) {
          shifts[editingIndex] = newShift;
          editingIndex = null;
        } else {
          shifts.push(newShift);
        }

        localStorage.setItem(`shifts_${currentUser}`, JSON.stringify(shifts));
        shiftForm.reset();
        displayShifts();
      });

      // Complete Display Functions
      const displayShifts = () => {
        const shifts = JSON.parse(localStorage.getItem(`shifts_${currentUser}`)) || [];
        weekList.innerHTML = '';

        // Group shifts by week
        const weeks = {};
        shifts.forEach((shift, index) => {
          const date = new Date(shift.date);
          const weekStart = new Date(date);
          weekStart.setDate(date.getDate() - (date.getDay() || 7) + 1); // Monday start
          
          const weekKey = `Week ${weekStart.getDate()}/${weekStart.getMonth()+1}/${weekStart.getFullYear().toString().slice(-2)}`;
          
          if (!weeks[weekKey]) {
            weeks[weekKey] = { shifts: [], total: 0 };
          }
          
          // Calculate earnings
          const hoursWorked = calculateHoursWorked(shift.startTime, shift.endTime, shift.breakTime);
          const payRate = getPayRate(shift.date, shift.startTime);
          const earnings = hoursWorked * payRate;
          
          weeks[weekKey].shifts.push({ ...shift, index, earnings });
          weeks[weekKey].total += earnings;
        });

        // Display each week
        Object.entries(weeks).forEach(([weekName, weekData]) => {
          const weekDiv = document.createElement('div');
          weekDiv.className = 'week-summary';

          // Week Header
          const header = document.createElement('div');
          header.className = 'week-header';
          header.innerHTML = `
            <div>${weekName}</div>
            <div>$${weekData.total.toFixed(2)}</div>
          `;

          // Week Details
          const details = document.createElement('div');
          details.className = 'week-details hidden';

          // Shifts List
          weekData.shifts.forEach(shift => {
            const shiftDiv = document.createElement('div');
            shiftDiv.className = 'shift-entry';
            shiftDiv.innerHTML = `
              <div><strong>Date:</strong> ${shift.date}</div>
              <div><strong>Time:</strong> ${format12h(shift.startTime)} - ${format12h(shift.endTime)}</div>
              <div><strong>Break:</strong> ${shift.breakTime} mins</div>
              <div><strong>Earnings:</strong> $${shift.earnings.toFixed(2)}</div>
              <div class="shift-actions">
                <button class="edit-btn" data-index="${shift.index}">Edit</button>
                <button class="delete-btn" data-index="${shift.index}">Delete</button>
              </div>
            `;
            details.appendChild(shiftDiv);
          });

          // Tax Calculation
          const taxSection = document.createElement('div');
          taxSection.className = 'tax-section';
          taxSection.innerHTML = `
            <button class="calculate-tax-btn">Calculate Tax</button>
            <div class="tax-results hidden">
              <p>Annual Income: $<span class="annual-income">0.00</span></p>
              <p>Annual Tax: $<span class="annual-tax">0.00</span></p>
              <p>Weekly Tax: $<span class="weekly-tax">0.00</span></p>
              <p>Effective Tax Rate: <span class="tax-rate">0.00</span>%</p>
            </div>
          `;

          taxSection.querySelector('.calculate-tax-btn').addEventListener('click', () => {
            const annualIncome = weekData.total * 52;
            const annualTax = calculateAnnualTax(annualIncome);
            const weeklyTax = annualTax / 52;
            const taxRate = (weeklyTax / weekData.total) * 100;

            taxSection.querySelector('.annual-income').textContent = annualIncome.toFixed(2);
            taxSection.querySelector('.annual-tax').textContent = annualTax.toFixed(2);
            taxSection.querySelector('.weekly-tax').textContent = weeklyTax.toFixed(2);
            taxSection.querySelector('.tax-rate').textContent = taxRate.toFixed(2);
            taxSection.querySelector('.tax-results').classList.remove('hidden');
          });

          details.appendChild(taxSection);
          header.addEventListener('click', () => details.classList.toggle('hidden'));
          weekDiv.append(header, details);
          weekList.appendChild(weekDiv);
        });

        // Add edit/delete handlers
        document.querySelectorAll('.edit-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            editingIndex = parseInt(e.target.dataset.index);
            loadShiftForEdit(editingIndex);
          });
        });

        document.querySelectorAll('.delete-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const index = parseInt(e.target.dataset.index);
            const shifts = JSON.parse(localStorage.getItem(`shifts_${currentUser}`)) || [];
            shifts.splice(index, 1);
            localStorage.setItem(`shifts_${currentUser}`, JSON.stringify(shifts));
            displayShifts();
          });
        });
      };

      // Helper Functions
      const calculateHoursWorked = (startTime, endTime, breakMinutes) => {
        const start = new Date(`1970-01-01T${startTime}`);
        const end = new Date(`1970-01-01T${endTime}`);
        return (end - start) / 1000 / 60 / 60 - (breakMinutes / 60);
      };

      const getPayRate = (dateString, startTime) => {
        const date = new Date(dateString);
        const [hours, period] = startTime.split(' ');
        const hour = parseInt(hours) + (period === 'PM' && hours !== '12' ? 12 : 0);
        
        const isWeekday = date.getDay() >= 1 && date.getDay() <= 5;
        const isNight = hour >= 18 || hour < 5;

        if (isWeekday) return isNight ? 39.76 : 32.07;
        if (date.getDay() === 6) return isNight ? 44.89 : 38.48; // Saturday
        return isNight ? 51.31 : 44.89; // Sunday
      };

      const calculateAnnualTax = (income) => {
        if (income <= 18200) return 0;
        if (income <= 45000) return (income - 18200) * 0.16;
        if (income <= 135000) return 4288 + (income - 45000) * 0.3;
        if (income <= 190000) return 31288 + (income - 135000) * 0.37;
        return 51638 + (income - 190000) * 0.45;
      };

      const format12h = (time24) => {
        const [hours, minutes] = time24.split(':');
        const hr = parseInt(hours);
        const period = hr >= 12 ? 'PM' : 'AM';
        const displayHr = hr % 12 || 12;
        return `${displayHr}:${minutes} ${period}`;
      };

      const loadShiftForEdit = (index) => {
        const shifts = JSON.parse(localStorage.getItem(`shifts_${currentUser}`)) || [];
        const shift = shifts[index];
        
        const [startHr, startMin] = shift.startTime.split(':');
        const [endHr, endMin] = shift.endTime.split(':');
        
        document.getElementById('date').value = shift.date;
        document.getElementById('startHour').value = format12h(shift.startTime).split(':')[0].padStart(2, '0');
        document.getElementById('startMinute').value = startMin;
        document.getElementById('startAmPm').value = parseInt(startHr) >= 12 ? 'PM' : 'AM';
        
        document.getElementById('endHour').value = format12h(shift.endTime).split(':')[0].padStart(2, '0');
        document.getElementById('endMinute').value = endMin;
        document.getElementById('endAmPm').value = parseInt(endHr) >= 12 ? 'PM' : 'AM';
        
        document.getElementById('breakTime').value = shift.breakTime;
        shiftForm.querySelector('button').textContent = 'Update Shift';
        window.scrollTo(0, 0);
      };
    });
  </script>
</body>
</html>
